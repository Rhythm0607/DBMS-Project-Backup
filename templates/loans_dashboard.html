{% extends "base.html" %}

{% block title %}My Loans - BankBase{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">My Loans</h2>
        <p class="card-subtitle">View your loans and request a new one.</p>
    </div>

    {% if accounts %}
    <form method="post" action="{{ url_for('customer_request_loan') }}" class="mb-3" id="loanRequestForm">
        <div class="grid grid-3">
            <div class="form-group">
                <label class="form-label" for="account_id">Linked Account</label>
                <select id="account_id" name="account_id" class="form-select" required>
                    <option value="">Select account</option>
                    {% for a in accounts %}
                    <option value="{{ a.account_id }}">
                        {{ a.account_number }} ({{ a.account_type }}) - {{ a.branch_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="loan_type">Loan Type</label>
                <select id="loan_type" name="loan_type" class="form-select" required>
                    <option value="Personal">Personal</option>
                    <option value="Home">Home</option>
                    <option value="Auto">Auto</option>
                    <option value="Education">Education</option>
                    <option value="Business">Business</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="principal_amount">Amount (INR)</label>
                <input type="number" step="0.01" min="1" id="principal_amount" name="principal_amount" class="form-input" required>
            </div>
        </div>
        <div class="grid grid-2 mt-2">
            <div class="form-group">
                <label class="form-label" for="tenure_months">Tenure (months)</label>
                <input type="number" min="1" id="tenure_months" name="tenure_months" class="form-input" required>
            </div>
            <div class="form-group" style="align-self: end;">
                <button type="submit" class="btn btn-primary" id="loanRequestBtn">
                    Request Loan
                </button>
            </div>
        </div>
    </form>
    {% else %}
    <p class="text-muted">You need an account before requesting a loan.</p>
    {% endif %}

    {% if loans %}
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Loan #</th>
                    <th>Type</th>
                    <th>Linked Account</th>
                    <th class="text-right">Principal</th>
                    <th class="text-right">Outstanding</th>
                    <th>Status</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for loan in loans %}
                <tr>
                    <td>{{ loan.loan_number }}</td>
                    <td>{{ loan.loan_type }}</td>
                    <td>{{ loan.account_number }}</td>
                    <td class="text-right money">{{ loan.principal_amount }}</td>
                    <td class="text-right money">{{ loan.outstanding_balance }}</td>
                    <td>
                        <span class="badge {{ bankbaseUtils.getStatusBadge(loan.status) if false }}">
                            {{ loan.status }}
                        </span>
                    </td>
                    <td class="text-right">
                        <a href="{{ url_for('customer_loan_detail', loan_id=loan.loan_id) }}" class="btn btn-secondary btn-small">
                            EMI Schedule
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="text-muted">You have no loans.</p>
    {% endif %}
</div>
{% endblock %}

